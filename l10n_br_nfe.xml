<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>

        <record model="ir.ui.view" id="l10n_br_inutilizacao_invoice_invalid_number_form">
            <field name="name">l10n_br_account.invoice.invalid.number.form</field>
            <field name="model">l10n_br_account.invoice.invalid.number</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="l10n_br_account.l10n_br_account_invoice_invalid_number_form"/>
            <field name="arch" type="xml">                
                <header position="replace">
                    <button name="action_draft_done"  colspan="2" string="Enviar SEFAZ" type="object" icon="gtk-convert" 
                    	attrs="{'invisible':['|',('id','==', False),('status','==','done')]}"/>                    		 
                    <field name="state" widget="statusbar" statusbar_visible="draft,not_authorized,done"/>
                </header>
                <field name="number_end" position="after">
                	<field name="id" invisible="1"/>                    
                    <field name="status" attrs="{'invisible':[('state','==','draft')]}"/>
                    <field name="message" attrs="{'invisible':[('state','==','draft')]}"/>
                    <field name="invalidate_number_nfe_invoice_id" attrs="{'invisible':[('state','==','draft')]}"/>                    
                </field>                
            </field>
        </record>
        
		
		<record model="ir.ui.view" id="view_l10n_br_envio_account_invoice_form">
			<field name="name">l10n_br_envio_account.invoice.form</field>
			<field name="model">account.invoice</field>
			<field name="priority">32</field>
			<field name="inherit_id" ref="account.invoice_form" />
			<field name="arch" type="xml">
				<button name="invoice_open" position="replace">	
					<button name="invoice_trysend" confirm="Confirma emissão da NF-e ?" states="sefaz_export" string="Enviar SEFAZ Direto" class="oe_highlight"  groups="base.group_user"/>
					<button name="invoice_resend" states="sefaz_exception" string="Habilitar re-envio" class="oe_highlight"  groups="base.group_user"/>
				</button>
				<xpath expr="//button[@name='invoice_cancel']" position="replace">
                    <button name="invoice_cancel" confirm="Deseja realmente cancelar a nota? Em caso de NF-e será efetuado o cancelamento on-line" states="draft,proforma2,sale,open,sefaz_export,sefaz_exception" string="Cancel Invoice" groups="account.group_account_invoice"/>
                </xpath>
				<field name="account_id" position="after">
					<field name="send_nfe_invoice_id" mode="form" attrs="{'readonly':True}"/>
				</field>                
           </field>
        </record>        
       
        <record id="l10n_br_account.tras_sefaz_export_open" model="workflow.transition">
            <field name="act_from" ref="l10n_br_account.act_sefaz_export"/>
            <field name="act_to" ref="l10n_br_account.act_sefaz_exception"/>
            <field name="condition">True</field>
            <field name="signal">invoice_trysend</field>
        </record>

		<record id="l10n_br_account.tras_sefaz_export_exception" model="workflow.transition">
            <field name="act_from" ref="l10n_br_account.act_sefaz_exception"/>
            <field name="act_to" ref="account.act_open"/>
            <field name="condition">(state=='open')</field>     
            <field name="signal" eval="False"/>  
        </record>
        
        <record id="tras_sefaz_export_to_exception" model="workflow.transition">
            <field name="act_from" ref="l10n_br_account.act_sefaz_exception"/>
            <field name="act_to" ref="l10n_br_account.act_sefaz_export"/>
            <field name="condition">True</field>
            <field name="signal">invoice_resend</field>
        </record>      
      
        <record id="l10n_br_account.act_sefaz_exception" model="workflow.activity">
            <field name="wkf_id" ref="account.wkf"/>
            <field name="name">sefaz_exception</field>
            <field name="action">
            	action_invoice_send_nfe()            	
            </field>
            <field name="kind">function</field>
        </record>


		<record id="l10n_br_nfe_send_invoice" model="ir.ui.view">
			<field name="name">Enviar Nota Fiscal</field>
			<field name="model">l10n_br_nfe.send_sefaz</field>
			<field name="arch" type="xml">
				<form string="Enviar Nota Fiscal" version="7.0">
					<field invisible="1" name="state"/>
					<field name="name" invisible="1" />
					<group>
						<group states="init" string="Clique em enviar para iniciar o envio...">
							<field name="name" />
							<field name="nfe_environment" />														
						</group>
						<group states="done" string="Resultado do Envio">
							<field nolabel="1" readonly="1" colspan="4" name="nfe_export_result">
								<tree colors="green:status == 'success';red:status == 'error'">
									<field name="xml_type"/>
									<field name="message"/>
									<field name="status"/>
								</tree>
							</field>
							<field name="file" colspan="4" filename="name"  />
						</group>
					</group>
						<footer states="init">
							<button name="invoice_open" string="Enviar SEFAZ" class="oe_highlight"/>
	                        <button special="cancel" string="Cancelar" type="object" class="oe_link"/>
                    	</footer>
	                    <footer states="done">
	                        <button special="cancel" string="Close" type="object"/>
	                    </footer>
				</form>
			</field>
		</record>


    </data>
</openerp>